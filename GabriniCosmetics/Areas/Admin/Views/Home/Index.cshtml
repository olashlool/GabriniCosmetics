@model GabriniCosmetics.Areas.Admin.Models.ViewModel.HomeVM
@inject GabriniCosmetics.Areas.Admin.Models.Interface.IOrder _order

<div class="container-fluid dashboard-3">
    <div class="row">
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Category</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0"><img src="~/admin/images/dashboard-2/svg-icon/total.png" alt="icon"></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalCategory</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Sub Category</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 sub-category-icon" style="background:#28604fbd"><i class="icon-dashboard fa-regular fa-layer-group"></i></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalSubCategory</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Products</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0"><img src="~/admin/images/dashboard-3/icon/shopping1.png" alt="icon"></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalProducts</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Feature Products</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-2">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 flex-shrink-Feature" style="background:#e5c494"><i class="icon-dashboard fa-light fa-cart-shopping"></i></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalFeatureProducts</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total New Products</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-2">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 flex-shrink-New" style="background: #fc8d62;"><i class="icon-dashboard fa-sharp fa-regular fa-bag-shopping"></i></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalNewProducts</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Sale Products</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-2">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 flex-shrink-Sale" style="background: #8da0cb;"><i class="icon-dashboard fa-regular fa-bag-shopping"></i></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalSaleProducts</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Pending Orders</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-3">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 flex-shrink-Pending" style="background:#D77748"><img src="~/admin/images/dashboard-3/icon/sent1.png" alt="icon"></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalPendingOrders</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Approve Orders</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 approve-icon" style="background: #0DA759;"><img src="~/admin/images/dashboard-2/svg-icon/check.png" alt="icon"></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalApproveOrders</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Rejected Orders</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 rejected-order" style="background: #E44141;"><img src="~/admin/images/details_close.png" alt="icon"></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalRejectedOrders</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total Paid Orders</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 paid-icon" style="background: #35c37b;"><i class="icon-dashboard fa-regular fa-light fa-money-bill"></i></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalPaid</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top daily-revenue-card">
                        <h4>Total UnPaid Orders</h4>
                    </div>
                </div>
                <div class="card-body pb-0 total-sells-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-shrink-0 unpaid-icon" style="background:#ef7272"><i class="icon-dashboard fa-regular fa-light fa-xmark-to-slot"></i></div>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2">
                                <h2>@Model.TotalUnPaid</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xxl-12 col-xl-12 col-sm-12">
            <div class="card">
                <div class="card-header card-no-border pb-0">
                    <div class="header-top">
                        <h4>Recent Orders</h4>
                    </div>
                </div>
                <div class="card-body pt-0 recent-orders px-0">
                    <div class="table-responsive theme-scrollbar" style="padding: 16px 24px 0px;">
                        <table class="table display" id="recent-orders" style="width:100%">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Customer</th>
                                    <th>Order Date</th>
                                    <th>QTY</th>
                                    <th>Price </th>
                                    <th>Status</th>
                                    <th>Payment Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.Orders)
                                {
                                    var orderItems = await _order.GetOrderItemsByOrderId(item.ID);

                                    <tr>
                                        <td>@item.ID</td>
                                        <td class="customer-img">
                                            <div class="d-flex align-items-center gap-2">
                                                <div class="flex-grow-1">
                                                    <h6> @item.FirstName @item.LastName </h6>
                                                </div>
                                            </div>
                                        </td>
                                        @{
                                            // Trim the semicolon if it exists
                                            string timestamp = item.Timestamp.TrimEnd(';');
                                            DateTime originalDate = DateTime.ParseExact(timestamp, "M/d/yyyy h:mm:ss tt", System.Globalization.CultureInfo.InvariantCulture);
                                            string formattedDate = originalDate.ToString("dd-MM-yyyy - hh.mmtt");
                                        }
                                        <td>@formattedDate</td>
                                        @{
                                            double? subtotal = 0;
                                            int quantity = 0;
                                            foreach (var orderItem in orderItems)
                                            {
                                                quantity += orderItem.Quantity;
                                                subtotal += orderItem.Quantity * ((orderItem.Product.Flags.Any(x => x.FlagType == "Sale"))
                                                ? orderItem.Product.PriceAfterDiscount
                                                : orderItem.Product.Price);
                                            }
                                            <td>QTY:@quantity</td>
                                            @if (orderItems?.FirstOrDefault() != null && orderItems.FirstOrDefault().TotalPrice != null)
                                            {
                                                <td>
                                                    <p>@orderItems.FirstOrDefault().TotalPrice</p>
                                                </td>
                                            }
                                            else
                                            {
                                                <td>
                                                    <p>@subtotal</p>
                                                </td>
                                            }

                                        }
                                        @if (item.OrderStatus == "Accepted")
                                        {
                                            <td>
                                                <div class="status-box">
                                                    <div class="btn background-light-success font-success f-w-500">@item.OrderStatus</div>
                                                </div>
                                            </td>
                                        }
                                        else if (item.OrderStatus == "Pending")
                                        {
                                            <td>
                                                <div class="status-box">
                                                    <div class="btn background-light-warning font-warning f-w-500">@item.OrderStatus</div>
                                                </div>
                                            </td>
                                        }
                                        else if (item.OrderStatus == "Rejected")
                                        {
                                            <td>
                                                <div class="status-box">
                                                    <div class="btn background-light-danger font-danger f-w-500">@item.OrderStatus</div>
                                                </div>
                                            </td>
                                        }
                                        @if (item.PaymentStstus == "Paid")
                                        {
                                            <td style="color:#0DA759">@item.PaymentStstus</td>
                                        }
                                        else if (item.PaymentStstus == "UnPaid")
                                        {
                                            <td style="color:#E44141">@item.PaymentStstus</td>
                                        }

                                        <td>
                                            <div>
                                                <button type="button" class="btn-model-edit" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                                    <i class="fa fa-edit"></i>
                                                </button>
                                                <a href="/Admin/Order/Details/@item.ID" class="btn-model-eye">
                                                    <i class="fa-sharp fa-regular fa-eye"></i>
                                                </a>
                                                <!-- Modal -->
                                                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="exampleModalLabel">Edit order</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                               <form action="/Admin/Order/Edit" method="post">
                                                                <input type="hidden" name="id" value="@item.ID" />
                                                                
                                                                <div class="mb-3">
                                                                    <label for="recipient-name" class="col-form-label">Name:</label>
                                                                    <input type="text" class="form-control" id="recipient-name" value="@item.FirstName @item.LastName" disabled>
                                                                </div>
                                                                
                                                                <div class="mb-3">
                                                                    <label for="recipient-phone" class="col-form-label">Phone:</label>
                                                                    <input type="text" class="form-control" id="recipient-phone" value="@item.Phone" disabled>
                                                                </div>
                                                                
                                                                <div class="mb-3">
                                                                    <label for="order-status" class="col-form-label">Order Status:</label>
                                                                    <select class="form-select" id="order-status" name="orderStatus">
                                                                        <option value="Pending" @(item.OrderStatus == "Pending" ? "selected" : "")>Pending</option>
                                                                        <option value="Accepted" @(item.OrderStatus == "Accepted" ? "selected" : "")>Accepted</option>
                                                                        <option value="Rejected" @(item.OrderStatus == "Rejected" ? "selected" : "")>Rejected</option>
                                                                    </select>
                                                                </div>
                                                                
                                                                <div class="mb-3">
                                                                    <label for="payment-status" class="col-form-label">Payment Status:</label>
                                                                    <select class="form-select" id="payment-status" name="paymentStatus">
                                                                        <option value="Paid" @(item.PaymentStstus == "Paid" ? "selected" : "")>Paid</option>
                                                                        <option value="UnPaid" @(item.PaymentStstus == "UnPaid" ? "selected" : "")>UnPaid</option>
                                                                    </select>
                                                                </div>
                                                                
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>

                                    </tr>

                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>